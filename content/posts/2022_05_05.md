---
title: SAML まわり
date: "2022-05-05T10:00:00.000Z"
template: "post"
slug: "/posts/2022-05-05/"
category: "daily"
description: "SAML のメモ"

---

以下読んだときのメモ

- [SAML入門](https://techbookfest.org/product/5255165663772672?productVariantID=5142951254556672)

### What is SAML

`認証` プロトコル。SSO 実現に利用できる。


### Why use SAML

SSO によるメリットを主に享受できる

- 入退社時のアカウント運用
- 対象アカウントの情報更新

これらを扱う場所を一つにすることで、ID に関するイベントを他のサービスで扱わなくて済むようになる。管理コストの軽減。

### Architecture

**登場人物**

- User Agent
  - ブラウザやモバイルアプリなど
- Service Provider (SP)
  - 認証情報を利用する側、SaaS 事業者などが当てはまる
- Identity Provider (IdP)
  - 認証情報を発行する側
    - Okta など


**認証シーケンス**

SP-initiated  

Service Provider からログインを行おうとした場合

```mermaid
sequenceDiagram
    participant Browser
    participant ServiceProvider
    participant IdentityProvider

    Browser->>ServiceProvider: login request
    ServiceProvider->>IdentityProvider: SAML request (redirect)
    IdentityProvider ->> Browser: start authentication
    Browser ->> IdentityProvider: send authentication data
    IdentityProvider ->> Browser: response authentication (SAML Response)
    Browser ->> ServiceProvider: send SAML Response
    ServiceProvider ->> Browser: done authentication
```

IdP-initiated

Identity Provider 側から Service Provider にアクセスしたときの場合。例えば、利用できる SaaS 一覧から対象 SaaS にアクセスするときなど。  


```mermaid
sequenceDiagram
    participant Browser
    participant ServiceProvider
    participant IdentityProvider

    Browser->>IdentityProvider: login request
    IdentityProvider->>Browser: response authentication (SAML Response)
    Browser ->> ServiceProvider: send SAML Response
    ServiceProvider ->> Browser: done authentication
```

各フローとも、IdP での認証成功時、SAML Assertion が生成される。これは、IdP で署名された認証情報。